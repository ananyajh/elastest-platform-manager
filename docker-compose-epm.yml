version: '3'
services:
    elastest-platform-manager:
        container_name: elastest-epm
        build: ./docker/elastest-platform-manager
        image: elastest/epm
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
        expose:
            - 8180
        ports:
            - 8180:8180
        networks:
            - build-image-network
    epm-adapter-docker-compose:
        container_name: elastest-epm-adapter-docker-compose
        image: elastest/epm-adapter-docker-compose
        entrypoint: python run.py --register-pop
        depends_on:
            - elastest-platform-manager
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:rw
        ports:
            - 50051:50051
        networks:
            - build-image-network
networks:
    build-image-network:
        driver: bridge
